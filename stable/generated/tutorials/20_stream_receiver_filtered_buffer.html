<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="StreamReceiver: real-time alpha band power" href="25_stream_receiver_regulation_of_alpha_waves.html" /><link rel="prev" title="StreamRecorder: resting-state recording" href="10_stream_recorder.html" />

    <link rel="shortcut icon" href="../../_static/bsl-icon.svg"/><!-- Generated with Sphinx 8.0.2 and Furo 2024.08.06 -->
        <title>StreamReceiver: real-time buffer filtered with a causal filter - BSL</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">BSL</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/icon-with-acronym.svg" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Install</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/index.html">API References</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API References</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/lsl.html">LSL (low-level)</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of LSL (low-level)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.lsl.StreamInfo.html">bsl.lsl.StreamInfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.lsl.StreamInlet.html">bsl.lsl.StreamInlet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.lsl.StreamOutlet.html">bsl.lsl.StreamOutlet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.lsl.library_version.html">bsl.lsl.library_version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.lsl.protocol_version.html">bsl.lsl.protocol_version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.lsl.local_clock.html">bsl.lsl.local_clock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.lsl.resolve_streams.html">bsl.lsl.resolve_streams</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/stream_classes.html">Stream classes</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Stream classes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.StreamReceiver.html">bsl.StreamReceiver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.StreamRecorder.html">bsl.StreamRecorder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.StreamPlayer.html">bsl.StreamPlayer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.StreamViewer.html">bsl.StreamViewer</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/triggers.html">Triggers</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Triggers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.triggers.TriggerDef.html">bsl.triggers.TriggerDef</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.triggers.MockTrigger.html">bsl.triggers.MockTrigger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.triggers.LSLTrigger.html">bsl.triggers.LSLTrigger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.triggers.ParallelPortTrigger.html">bsl.triggers.ParallelPortTrigger</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/utils.html">Utilities</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Utilities</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.datasets.eeg_resting_state.data_path.html">bsl.datasets.eeg_resting_state.data_path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.datasets.eeg_resting_state_short.data_path.html">bsl.datasets.eeg_resting_state_short.data_path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.datasets.eeg_auditory_stimuli.data_path.html">bsl.datasets.eeg_auditory_stimuli.data_path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.datasets.trigger_def.data_path.html">bsl.datasets.trigger_def.data_path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.add_file_handler.html">bsl.add_file_handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.set_log_level.html">bsl.set_log_level</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.sys_info.html">bsl.sys_info</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.utils.find_event_channel.html">bsl.utils.find_event_channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.utils.io.pcl2fif.html">bsl.utils.io.pcl2fif</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.utils.lsl.list_lsl_streams.html">bsl.utils.lsl.list_lsl_streams</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.utils.lsl.lsl_channel_list.html">bsl.utils.lsl.lsl_channel_list</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/generated/bsl.utils.lsl.search_lsl.html">bsl.utils.lsl.search_lsl</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../command_line.html">Command-Line</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="00_stream_player.html">StreamPlayer: simulate an LSL stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="10_stream_recorder.html">StreamRecorder: resting-state recording</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">StreamReceiver: real-time buffer filtered with a causal filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="25_stream_receiver_regulation_of_alpha_waves.html">StreamReceiver: real-time alpha band power</a></li>
<li class="toctree-l2"><a class="reference internal" href="99_logging.html">Logging</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/generated/tutorials/20_stream_receiver_filtered_buffer.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-generated-tutorials-20-stream-receiver-filtered-buffer-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="streamreceiver-real-time-buffer-filtered-with-a-causal-filter">
<span id="sphx-glr-generated-tutorials-20-stream-receiver-filtered-buffer-py"></span><h1>StreamReceiver: real-time buffer filtered with a causal filter<a class="headerlink" href="#streamreceiver-real-time-buffer-filtered-with-a-causal-filter" title="Link to this heading">¶</a></h1>
<p>A <a class="reference internal" href="../../api/generated/bsl.StreamReceiver.html#bsl.StreamReceiver" title="bsl.StreamReceiver"><code class="xref py py-obj docutils literal notranslate"><span class="pre">StreamReceiver</span></code></a> can be used to create a data buffer on which different
operations have already been applied. For instance, a buffer where data is
filtered with a bandpass filter.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors: Mathieu Scheltienne &lt;mathieu.scheltienne@fcbg.ch&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: LGPL-2.1</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Both <a class="reference internal" href="../../api/generated/bsl.StreamPlayer.html#bsl.StreamPlayer" title="bsl.StreamPlayer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">StreamPlayer</span></code></a> and <a class="reference internal" href="../../api/generated/bsl.StreamRecorder.html#bsl.StreamRecorder" title="bsl.StreamRecorder"><code class="xref py py-obj docutils literal notranslate"><span class="pre">StreamRecorder</span></code></a> create a new process
to stream or record data. On Windows, mutliprocessing suffers a couple of
restrictions. The entry-point of a multiprocessing program should be
protected with <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__':</span></code> to ensure it can safely
import and run the module. More information on the
<a class="reference external" href="https://docs.python.org/2/library/multiprocessing.html#windows">documentation for multiprocessing on Windows</a>.</p>
</div>
<p>This example will use a sample EEG resting-state dataset that can be retrieve
with <a class="reference internal" href="../../api/utils.html#datasets"><span class="std std-ref">bsl.datasets</span></a>. The dataset is stored in the user home
directory in the folder <code class="docutils literal notranslate"><span class="pre">bsl_data</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">C:\Users\User\bsl_data</span></code>).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <a href="https://docs.python.org/3/library/math.html#math.ceil" title="math.ceil" class="sphx-glr-backref-module-math sphx-glr-backref-type-py-function"><span class="n">ceil</span></a>

<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.butter.html#scipy.signal.butter" title="scipy.signal.butter" class="sphx-glr-backref-module-scipy-signal sphx-glr-backref-type-py-function"><span class="n">butter</span></a><span class="p">,</span> <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.sosfilt.html#scipy.signal.sosfilt" title="scipy.signal.sosfilt" class="sphx-glr-backref-module-scipy-signal sphx-glr-backref-type-py-function"><span class="n">sosfilt</span></a><span class="p">,</span> <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.sosfilt_zi.html#scipy.signal.sosfilt_zi" title="scipy.signal.sosfilt_zi" class="sphx-glr-backref-module-scipy-signal sphx-glr-backref-type-py-function"><span class="n">sosfilt_zi</span></a>

<span class="kn">from</span> <span class="nn">bsl</span> <span class="kn">import</span> <a href="../../api/generated/bsl.StreamPlayer.html#bsl.StreamPlayer" title="bsl.StreamPlayer" class="sphx-glr-backref-module-bsl sphx-glr-backref-type-py-class"><span class="n">StreamPlayer</span></a><span class="p">,</span> <a href="../../api/generated/bsl.StreamReceiver.html#bsl.StreamReceiver" title="bsl.StreamReceiver" class="sphx-glr-backref-module-bsl sphx-glr-backref-type-py-class"><span class="n">StreamReceiver</span></a><span class="p">,</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">bsl.utils</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
<p>To simulate an actual signal coming from an LSL stream, a <a class="reference internal" href="../../api/generated/bsl.StreamPlayer.html#bsl.StreamPlayer" title="bsl.StreamPlayer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">StreamPlayer</span></code></a>
is used with a 40 seconds resting-state recording. This dataset is already
filtered between (1, 40) Hz.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">stream_name</span></a> <span class="o">=</span> <span class="s2">&quot;StreamPlayer&quot;</span>
<a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fif_file</span></a> <span class="o">=</span> <a href="../../api/generated/bsl.datasets.eeg_resting_state.data_path.html#bsl.datasets.eeg_resting_state.data_path" title="bsl.datasets.eeg_resting_state.data_path" class="sphx-glr-backref-module-bsl-datasets-eeg_resting_state sphx-glr-backref-type-py-function"><span class="n">datasets</span><span class="o">.</span><span class="n">eeg_resting_state</span><span class="o">.</span><span class="n">data_path</span></a><span class="p">()</span>
<a href="../../api/generated/bsl.StreamPlayer.html#bsl.StreamPlayer" title="bsl.StreamPlayer" class="sphx-glr-backref-module-bsl sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">player</span></a> <span class="o">=</span> <a href="../../api/generated/bsl.StreamPlayer.html#bsl.StreamPlayer" title="bsl.StreamPlayer" class="sphx-glr-backref-module-bsl sphx-glr-backref-type-py-class"><span class="n">StreamPlayer</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">stream_name</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fif_file</span></a><span class="p">)</span>
<a href="../../api/generated/bsl.StreamPlayer.html#bsl.StreamPlayer.start" title="bsl.StreamPlayer.start" class="sphx-glr-backref-module-bsl sphx-glr-backref-type-py-method"><span class="n">player</span><span class="o">.</span><span class="n">start</span></a><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/generated/bsl.StreamPlayer.html#bsl.StreamPlayer" title="bsl.StreamPlayer" class="sphx-glr-backref-module-bsl sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">player</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Player: StreamPlayer | ON | /home/runner/bsl_data/eeg_sample/resting_state-raw.fif&gt;
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://mne.tools/stable/generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.io.read_raw_fif.html#mne.io.read_raw_fif" title="mne.io.read_raw_fif" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_fif</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fif_file</span></a><span class="p">,</span> <span class="n">preload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BP filter between: </span><span class="si">{</span><a href="https://mne.tools/stable/generated/mne.Info.html#mne.Info" title="mne._fiff.meas_info.Info" class="sphx-glr-backref-module-mne-_fiff-meas_info sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span><span class="o">.</span><span class="n">info</span></a><span class="p">[</span><span class="s1">&#39;highpass&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><a href="https://mne.tools/stable/generated/mne.Info.html#mne.Info" title="mne._fiff.meas_info.Info" class="sphx-glr-backref-module-mne-_fiff-meas_info sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span><span class="o">.</span><span class="n">info</span></a><span class="p">[</span><span class="s1">&#39;lowpass&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Hz&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>BP filter between: 1.0, 40.0 Hz
</pre></div>
</div>
<section id="filter">
<h2>Filter<a class="headerlink" href="#filter" title="Link to this heading">¶</a></h2>
<p>Data should be filtered along one dimension. For this example, a butter IIR
filter is used. More information on filtering is available on the MNE
documentation:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://mne.tools/stable/auto_tutorials/preprocessing/25_background_filtering.html#disc-filtering">Background information on filtering</a></p></li>
<li><p><a class="reference external" href="https://mne.tools/stable/auto_tutorials/preprocessing/30_filtering_resampling.html#tut-filter-resample">Filtering and resampling data</a></p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_bandpass_filter</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a bandpass filter using a butter filter of order n.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    low : float</span>
<span class="sd">        The lower pass-band edge.</span>
<span class="sd">    high : float</span>
<span class="sd">        The upper pass-band edge.</span>
<span class="sd">    fs : float</span>
<span class="sd">        Sampling rate of the data.</span>
<span class="sd">    n : int</span>
<span class="sd">        Order of the filter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sos : array</span>
<span class="sd">        Second-order sections representation of the IIR filter.</span>
<span class="sd">    zi_coeff : array</span>
<span class="sd">        Initial condition for sosfilt for step response steady-state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Divide by the Nyquist frequency</span>
    <span class="n">bp_low</span> <span class="o">=</span> <span class="n">low</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
    <span class="n">bp_high</span> <span class="o">=</span> <span class="n">high</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
    <span class="c1"># Compute SOS output (second order sections)</span>
    <span class="n">sos</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.butter.html#scipy.signal.butter" title="scipy.signal.butter" class="sphx-glr-backref-module-scipy-signal sphx-glr-backref-type-py-function"><span class="n">butter</span></a><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">[</span><span class="n">bp_low</span><span class="p">,</span> <span class="n">bp_high</span><span class="p">],</span> <span class="n">btype</span><span class="o">=</span><span class="s2">&quot;band&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;sos&quot;</span><span class="p">)</span>
    <span class="c1"># Construct initial conditions for sosfilt for step response steady-state.</span>
    <span class="n">zi_coeff</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.sosfilt_zi.html#scipy.signal.sosfilt_zi" title="scipy.signal.sosfilt_zi" class="sphx-glr-backref-module-scipy-signal sphx-glr-backref-type-py-function"><span class="n">sosfilt_zi</span></a><span class="p">(</span><span class="n">sos</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">sos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">sos</span><span class="p">,</span> <span class="n">zi_coeff</span>
</pre></div>
</div>
<p>EEG data is usually subject to a lage DC offset, which corresponds to a step
response steady-state. The initial conditions are determined by multiplying
the <code class="docutils literal notranslate"><span class="pre">zi_coeff</span></code> with the DC offset. The DC offset value can be approximated
by taking the mean of a small window.</p>
</section>
<section id="buffer">
<h2>Buffer<a class="headerlink" href="#buffer" title="Link to this heading">¶</a></h2>
<p>When creating the filtered buffer, the duration has to be define to create a
numpy array of the correct shape and pre-allocate the required space.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">buffer_duration</span></a> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># in seconds</span>
</pre></div>
</div>
<p>Then, a <a class="reference internal" href="../../api/generated/bsl.StreamReceiver.html#bsl.StreamReceiver" title="bsl.StreamReceiver"><code class="xref py py-obj docutils literal notranslate"><span class="pre">StreamReceiver</span></code></a> is created. But the actual buffer and window
size of the <a class="reference internal" href="../../api/generated/bsl.StreamReceiver.html#bsl.StreamReceiver" title="bsl.StreamReceiver"><code class="xref py py-obj docutils literal notranslate"><span class="pre">StreamReceiver</span></code></a> are set as small as possible. The buffer
from the <a class="reference internal" href="../../api/generated/bsl.StreamReceiver.html#bsl.StreamReceiver" title="bsl.StreamReceiver"><code class="xref py py-obj docutils literal notranslate"><span class="pre">StreamReceiver</span></code></a> is only used to store the last samples until
they are retrieved, filtered, and added to the filtered buffer. In this
example, the <a class="reference internal" href="../../api/generated/bsl.StreamReceiver.html#bsl.StreamReceiver" title="bsl.StreamReceiver"><code class="xref py py-obj docutils literal notranslate"><span class="pre">StreamReceiver</span></code></a> buffer and window size are set to 200 ms.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="o">=</span> <a href="../../api/generated/bsl.StreamReceiver.html#bsl.StreamReceiver" title="bsl.StreamReceiver" class="sphx-glr-backref-module-bsl sphx-glr-backref-type-py-class"><span class="n">StreamReceiver</span></a><span class="p">(</span><span class="n">bufsize</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">winsize</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">stream_name</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">stream_name</span></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/time.html#time.sleep" title="time.sleep" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">sleep</span></a><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># wait to fill LSL inlet.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A <a class="reference internal" href="../../api/generated/bsl.StreamReceiver.html#bsl.StreamReceiver" title="bsl.StreamReceiver"><code class="xref py py-obj docutils literal notranslate"><span class="pre">StreamReceiver</span></code></a> opens an LSL inlet for each connected stream at
initialization. The inlet’s buffer is empty when created and fills up as
time passes. Data is pulled from the LSL inlet each time
<a class="reference internal" href="../../api/generated/bsl.StreamReceiver.html#bsl.StreamReceiver.acquire" title="bsl.StreamReceiver.acquire"><code class="xref py py-obj docutils literal notranslate"><span class="pre">acquire</span></code></a> is called.</p>
</div>
<p>The filtered buffer can be define as a class that uses the elements created
previously. The method <code class="docutils literal notranslate"><span class="pre">.update()</span></code> pulls new samples from the LSL stream,
filters and add them to the buffer while removing older samples that are now
exiting the buffer.</p>
<p>The <a class="reference internal" href="../../api/generated/bsl.StreamReceiver.html#bsl.StreamReceiver" title="bsl.StreamReceiver"><code class="xref py py-obj docutils literal notranslate"><span class="pre">StreamReceiver</span></code></a> appends a <code class="docutils literal notranslate"><span class="pre">TRIGGER</span></code> channel at the beginning of
the data array. For filtering, the trigger channel is not needed. Thus, the
number of channels is reduced by 1 and the first channel on the
<code class="docutils literal notranslate"><span class="pre">(samples,</span> <span class="pre">channels)</span></code> data array is ignored.</p>
<p>For this example, the filter is defined between 5 and 10 Hz to emphasize its
effect as the dataset streamed is already filtered between (1, 40) Hz.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Buffer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A buffer containing filter data and its associated timestamps.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    buffer_duration : float</span>
<span class="sd">        Length of the buffer in seconds.</span>
<span class="sd">    sr : bsl.StreamReceiver</span>
<span class="sd">        StreamReceiver connected to the desired data stream.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">buffer_duration</span></a><span class="p">,</span> <span class="n">sr</span><span class="p">):</span>
        <span class="c1"># Store the StreamReceiver in a class attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr</span> <span class="o">=</span> <span class="n">sr</span>

        <span class="c1"># Retrieve sampling rate and number of channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr</span><span class="o">.</span><span class="n">streams</span><span class="p">[</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">stream_name</span></a><span class="p">]</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_channels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr</span><span class="o">.</span><span class="n">streams</span><span class="p">[</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">stream_name</span></a><span class="p">]</span><span class="o">.</span><span class="n">ch_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># Define duration</span>
        <span class="bp">self</span><span class="o">.</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">buffer_duration</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">buffer_duration</span></a>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer_duration_samples</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/math.html#math.ceil" title="math.ceil" class="sphx-glr-backref-module-math sphx-glr-backref-type-py-function"><span class="n">ceil</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">buffer_duration</span></a> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>

        <span class="c1"># Create data array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.zeros.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_duration_samples</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.zeros.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_duration_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_channels</span><span class="p">))</span>
        <span class="c1"># For demo purposes, let&#39;s store also the raw data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.zeros.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_duration_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_channels</span><span class="p">))</span>

        <span class="c1"># Create filter BP (1, 15) Hz and filter variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zi_coeff</span> <span class="o">=</span> <span class="n">create_bandpass_filter</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zi</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the buffer with new samples from the StreamReceiver. This method</span>
<span class="sd">        should be called regularly, with a period at least smaller than the</span>
<span class="sd">        StreamReceiver buffer length.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Acquire new data points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">data_acquired</span><span class="p">,</span> <span class="n">ts_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr</span><span class="o">.</span><span class="n">get_buffer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr</span><span class="o">.</span><span class="n">reset_buffer</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># break early, no new samples</span>

        <span class="c1"># Remove trigger channel</span>
        <span class="n">data_acquired</span> <span class="o">=</span> <span class="n">data_acquired</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># Filter acquired data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Initialize the initial conditions for the cascaded filter delays.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zi_coeff</span> <span class="o">*</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.mean.html#numpy.mean" title="numpy.mean" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">mean</span></a><span class="p">(</span><span class="n">data_acquired</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">data_filtered</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zi</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.sosfilt.html#scipy.signal.sosfilt" title="scipy.signal.sosfilt" class="sphx-glr-backref-module-scipy-signal sphx-glr-backref-type-py-function"><span class="n">sosfilt</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sos</span><span class="p">,</span> <span class="n">data_acquired</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zi</span><span class="p">)</span>

        <span class="c1"># Roll buffer, remove samples exiting and add new samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.roll.html#numpy.roll" title="numpy.roll" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">roll</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span><span class="p">,</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ts_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ts_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.roll.html#numpy.roll" title="numpy.roll" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">roll</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ts_list</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data_filtered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.roll.html#numpy.roll" title="numpy.roll" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">roll</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">,</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ts_list</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data_acquired</span>
</pre></div>
</div>
</section>
<section id="testing-the-filtered-buffer">
<h2>Testing the filtered buffer<a class="headerlink" href="#testing-the-filtered-buffer" title="Link to this heading">¶</a></h2>
<p>The filtered buffer must be updated regularly. In this example, the
<a class="reference internal" href="../../api/generated/bsl.StreamReceiver.html#bsl.StreamReceiver" title="bsl.StreamReceiver"><code class="xref py py-obj docutils literal notranslate"><span class="pre">StreamReceiver</span></code></a> buffer has been initialized at 200 ms. Thus, the
filtered buffer should be updated at most every 200 ms, else, there is a risk
that a couple of samples will be missed between 2 updates.</p>
<p>A 15 seconds acquisition is used to test the buffer. Every 5 seconds, the
buffer is retrieved and plotted.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create plot</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">f</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Raw data&quot;</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Filtered data between (5, 10) Hz&quot;</span><span class="p">)</span>
<span class="c1"># Create buffer</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="n">Buffer</span><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">buffer_duration</span></a><span class="p">,</span> <span class="n">sr</span><span class="p">)</span>

<span class="c1"># Start by filling once the entire buffer (to get rid of the initialization 0)</span>
<span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
<span class="k">while</span> <span class="n">timer</span><span class="o">.</span><span class="n">sec</span><span class="p">()</span> <span class="o">&lt;=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">buffer_duration</span></a><span class="p">:</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

<span class="c1"># Acquire during 15 seconds and plot every 5 seconds</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">idx_last_plot</span></a> <span class="o">=</span> <span class="mi">1</span>
<span class="n">timer</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">while</span> <span class="n">timer</span><span class="o">.</span><span class="n">sec</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">:</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="c1"># check if we just passed the 5s between plot limit</span>
    <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">sec</span><span class="p">()</span> <span class="o">//</span> <span class="mi">5</span> <span class="o">==</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">idx_last_plot</span></a><span class="p">:</span>
        <span class="c1"># average all channels to simulate an evoked response</span>
        <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">buffer</span><span class="o">.</span><span class="n">timestamps</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.mean.html#numpy.mean" title="numpy.mean" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">mean</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">buffer</span><span class="o">.</span><span class="n">raw_data</span></a><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">buffer</span><span class="o">.</span><span class="n">timestamps</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.mean.html#numpy.mean" title="numpy.mean" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">mean</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">buffer</span><span class="o">.</span><span class="n">data</span></a><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">idx_last_plot</span></a> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_20_stream_receiver_filtered_buffer_001.png" srcset="../../_images/sphx_glr_20_stream_receiver_filtered_buffer_001.png" alt="Raw data, Filtered data between (5, 10) Hz" class = "sphx-glr-single-img"/><p>Stop the mock LSL stream.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">sr</span>  <span class="c1"># disconnects and close the LSL inlet.</span>
<a href="../../api/generated/bsl.StreamPlayer.html#bsl.StreamPlayer.stop" title="bsl.StreamPlayer.stop" class="sphx-glr-backref-module-bsl sphx-glr-backref-type-py-method"><span class="n">player</span><span class="o">.</span><span class="n">stop</span></a><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 22.797 seconds)</p>
<p><strong>Estimated memory usage:</strong>  210 MB</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-generated-tutorials-20-stream-receiver-filtered-buffer-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/fbfc89cac0f671a1be89aff666b558f7/20_stream_receiver_filtered_buffer.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">20_stream_receiver_filtered_buffer.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/125b261d6c779e1549e181b3278493ab/20_stream_receiver_filtered_buffer.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">20_stream_receiver_filtered_buffer.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/fed55020f45895f32cce4264814e0820/20_stream_receiver_filtered_buffer.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">20_stream_receiver_filtered_buffer.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="25_stream_receiver_regulation_of_alpha_waves.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">StreamReceiver: real-time alpha band power</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="10_stream_recorder.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">StreamRecorder: resting-state recording</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, M. Scheltienne, A. Desvachez, K. Lee
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/fcbg-platforms/bsl" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">StreamReceiver: real-time buffer filtered with a causal filter</a><ul>
<li><a class="reference internal" href="#filter">Filter</a></li>
<li><a class="reference internal" href="#buffer">Buffer</a></li>
<li><a class="reference internal" href="#testing-the-filtered-buffer">Testing the filtered buffer</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=73d9a94e"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    </body>
</html>